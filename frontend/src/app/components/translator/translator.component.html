<article fxLayout="column">

  <span class="jumbotron negative-margin-bottom" fxLayout="column" fxLayoutAlign="center center" fxFlexFill>
    <h3>{{ project?.name }}</h3>
    <p>{{ project?.description }}</p>
  </span>

  <span fxLayout="column" fxLayoutGap="1em" class="px-5">

    <mat-card [formGroup]="translatorForm" class="mat-elevation-z4 app-no-padding-top-card">
      <!-- Language selector -->
      <div fxLayoutAlign="space-between center">
        <nav mat-tab-nav-bar>
          <span mat-tab-link *ngFor="let lang of languages" (click)="onLanguageClick('sourceLanguageCode', lang.label)"
            [active]="f['sourceLanguageCode'].value == lang.label">
            {{ lang.name.toUpperCase() }}
          </span>
        </nav>
        <button mat-button mat-icon-button (click)="toggleSourceTargetLanguage()" matTooltip="Swap languages">
          <mat-icon>compare_arrows</mat-icon>
        </button>
        <nav mat-tab-nav-bar>
          <span mat-tab-link *ngFor="let lang of languages" (click)="onLanguageClick('targetLanguageCode', lang.label)"
            [active]="f['targetLanguageCode'].value == lang.label">
            {{ lang.name.toUpperCase() }}
          </span>
        </nav>
      </div>

      <mat-divider></mat-divider>

      <mat-card-content fxLayout="row" fxLayoutAlign="center start" class="p-2">

        <!-- Input -->
        <section fxFlex="50">
          <!-- Load sample text -->
          <mat-form-field>
            <mat-label>Load a sample text</mat-label>
            <mat-select formControlName="sample">
              <!-- <mat-option>None</mat-option> -->
              <mat-optgroup *ngFor="let group of sampleGroups" [label]="group.language.name.toUpperCase()">
                <mat-option *ngFor="let sample of group.samples" [value]="sample.filename"
                  (click)="loadSampleText(sample); onLanguageClick('sourceLanguageCode', sample.language)">
                  {{ sample.filename }}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
          <button mat-button mat-icon-button aria-label="Clear"
            (click)="translatorForm.reset({ sourceLanguageCode: 'es', targetLanguageCode: 'en' })"
            [disabled]="!f['text'].value" matTooltip="Clear text">
            <mat-icon>close</mat-icon>
          </button>
          <!-- Textarea -->
          <mat-form-field fxFill>
            <textarea matInput rows="10" formControlName="text" placeholder="Enter your text"
              required>{{ sourceText }}</textarea>
            <mat-error>
              <span *ngIf="f['text'].errors?.required">
                Input text is <strong>required</strong>.
              </span>
              <span *ngIf="f['text'].errors?.maxlength">
                Input text exeeds the maximum of <strong>{{ MAX_CHARACTERS }} characters</strong>.
              </span>
            </mat-error>
          </mat-form-field>
          <div fxLayout="column" fxLayoutAlign="center center">
            <button mat-raised-button color="accent" (click)="translate()" [disabled]="f['text'].errors">
              TRANSLATE
            </button>
            <app-loader fxFill class="mt-2"></app-loader>
          </div>
        </section>

        <!-- Output -->
        <section fxFlex="50" fxLayout="column" fxLayoutAlign="space-between end" fxLayoutGap="1em">
          <span fxFlexAlign="start" *ngIf="response?.success" style="background-color: rgb(241, 241, 241)">
            {{ translatedText }}
          </span>
          <a mat-button mat-icon-button color="primary" class="text-decoration-none" [href]="downloadLink"
            [download]="downloadFilename" matTooltip="Download JSON response" *ngIf="response?.success">
            <i class="material-icons">file_download</i>
          </a>
        </section>

      </mat-card-content>
    </mat-card>

    <span fxLayout="row" fxLayoutAlign="end">
      <mat-expansion-panel *ngIf="response?.success" fxFlex="50">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Summary
          </mat-panel-title>
        </mat-expansion-panel-header>
        <p>Total sentences: {{ response.data.translatedSentences.length }}</p>
        <p>Average prediction score: {{ averageScore }} (always negative)</p>
        <p>Translation time: {{ translationTime }} seconds</p>
      </mat-expansion-panel>
    </span>

  </span>

</article>